<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UHSæœé£¾åº— - æ‚¨çš„æ™‚å°šé¸æ“‡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --text-color: #333;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f8f9fa;
        }

        /* ========== å»£æ’­ç³»çµ±ä¿®æ”¹ï¼šç”±å³è‡³å·¦æ…¢æ…¢æ»¾å‹• ========== */
        .announcement-bar {
            background: #a30000; /* æ·±ç´…è‰²èƒŒæ™¯ */
            color: white;
            height: 35px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            z-index: 1100;
        }

        .announcement-content {
            white-space: nowrap;
            position: absolute;
            /* ä¿®æ”¹å‹•ç•«ï¼šç”±å³ 100% æ»¾å‹•è‡³å·¦ -100% */
            animation: scroll-right-to-left 25s linear infinite;
            font-size: 14px;
            font-weight: bold;
        }

        @keyframes scroll-right-to-left {
            0% { transform: translateX(100vw); } /* å¾è¢å¹•æœ€å³å´å¤–é¢é–‹å§‹ */
            100% { transform: translateX(-100%); } /* æ»¾å‹•åˆ°å·¦å´å®Œå…¨æ¶ˆå¤± */
        }

        /* ========== å°èˆªæ¬„ ========== */
        /* ========== å°èˆªæ¬„ä¿®æ”¹ï¼šæ”¹ç‚ºè³ªæ„Ÿç™½åº•é»‘å­— ========== */
.navbar {
    background: #ffffff; /* ç´”ç™½èƒŒæ™¯ */
    padding: 15px 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    /* ä¿®æ”¹é™°å½±ç‚ºè¼ƒæ·ºçš„ç°è‰²ï¼Œç¬¦åˆç™½è‰²èª¿æ€§ */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); 
    border-bottom: 1px solid #eeeeee; /* åŠ ä¸Šæ·ºç°ç´°ç·šå€éš” */
}

/* å¼·åˆ¶å°è¦½åˆ—å…§çš„æ–‡å­—ã€é€£çµã€æŒ‰éˆ•ç‚ºé»‘è‰² */
.nav-links a, 
.nav-links button, 
.nav-links span {
    color: #333333 !important; /* æ·±ç°è‰²ï¼ˆæ¯”ç´”é»‘æ›´æœ‰è³ªæ„Ÿï¼‰ */
    font-weight: 500;
}

/* é‡å° Logo å“ç‰Œåç¨±å¦‚æœä¹Ÿæƒ³æ”¹é»‘å­—ï¼ˆè‹¥åŸæœ¬æ˜¯ç™½è‰²ï¼‰ */
.logo {
    color: #333333 !important;
}

/* æ»‘é¼ ç§»ä¸Šå»æ™‚çš„æ•ˆæœï¼ˆç¨å¾®è®Šæ·¡æˆ–è®Šè‰²ï¼‰ */
.nav-links a:hover, 
.nav-links button:hover {
    color: var(--primary-color) !important; /* æ‡¸åœæ™‚è®Šå›æ‚¨çš„ä¸»è‰²èª¿ç´…è‰² */
    opacity: 1;
}

/* æœƒå“¡å€å¡ŠæŒ‰éˆ•èƒŒæ™¯ç¨å¾®åŠ æ·±ï¼Œä»¥ä¾¿åœ¨ç™½åº•ä¸Šé¡¯ç¾ */
.user-display-btn {
    background: #f5f5f5 !important; /* æ·ºç°è‰²èƒŒæ™¯ */
    color: #333333 !important;
}
        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
        font-size: 24px;
        font-weight: bold;
        color: #333333 !important; /* ç¢ºä¿åœ¨ç™½åº•å°è¦½åˆ—æ˜¯é»‘å­— */
        cursor: pointer;           /* æ»‘é¼ ç§»ä¸Šå»æœƒè®Šæˆæ‰‹æŒ‡é ­ */
        transition: transform 0.2s, opacity 0.2s;
        user-select: none;         /* é˜²æ­¢æ–‡å­—è¢«é¸å–è—è—çš„ */
        }

        .logo:hover {
        transform: scale(1.02);    /* ç¨å¾®æ”¾å¤§å¢åŠ äº’å‹•æ„Ÿ */
        opacity: 0.8;              /* ç¨å¾®è®Šé€æ˜ */
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-links a, .nav-links button {
            color: white;
            text-decoration: none;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            transition: opacity 0.3s;
        }

        .nav-links a:hover, .nav-links button:hover {
            opacity: 0.8;
        }

        /* æœƒå“¡ç­‰ç´šæ¨™ç±¤æ¨£å¼ */
        .rank-badge {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: 5px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .rank-silver { background: #bdc3c7; color: #2c3e50; }
        .rank-gold { background: #f1c40f; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
        .rank-diamond { background: #3498db; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }

        .user-dropdown {
            position: relative;
            display: inline-block;
        }

        .user-display-btn {
            background: rgba(255, 255, 255, 0.2) !important;
            padding: 8px 15px !important;
            border-radius: 20px !important;
            font-weight: bold;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 120%;
            right: 0;
            background: white;
            min-width: 180px;
            box-shadow: var(--box-shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
            z-index: 1001;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-menu a {
            color: var(--text-color) !important;
            padding: 12px 20px;
            display: block;
            font-size: 14px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .dropdown-menu a:last-child {
            border-bottom: none;
        }

        .dropdown-menu a:hover {
            background: #f8f9fa;
            opacity: 1 !important;
        }

        .cart-icon {
            position: relative;
            font-size: 24px;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff3838;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* ========== ç°½åˆ°/è½‰ç›¤å°æ¨£å¼ ========== */
        .checkin-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .checkin-day {
            padding: 10px 5px;
            border-radius: 8px;
            border: 2px solid #eee;
            background: white;
            text-align: center;
            transition: all 0.3s;
        }
        .checkin-day.completed {
            border-color: var(--secondary-color);
            background: #e0f7f6;
        }

        .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
            border-radius: 50%;
            border: 5px solid var(--dark-color);
            overflow: hidden;
            background: #fff;
            transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1);
        }
        .wheel-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #e74c3c;
            z-index: 100;
        }

        /* ========== äºŒæ‰‹è½‰è®“é é¢æ¨£å¼ ========== */
        .resale-container {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .resale-form-group {
            margin-bottom: 20px;
        }

        .resale-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .resale-form-group input, .resale-form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
        }

        .resale-image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            margin-top: 10px;
            border-radius: 4px;
            display: none;
            border: 1px solid #eee;
        }

        /* ========== é¦–é è‹±é›„å€ ========== */
        .hero {
        /* 1. ä¿ç•™æ¼¸å±¤é®ç½©ï¼Œå¯ä»¥è®“ç™½è‰²çš„æ–‡å­—åœ¨ä»»ä½•èƒŒæ™¯ä¸Šéƒ½æ¸…æ™°å¯è¦‹ */
        background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), 
                url('é¦–é 2.jpg'); /* ç›´æ¥å¡«å…¥æ‚¨çš„åœ–ç‰‡æª”å */
    
        /* 2. ç¢ºä¿åœ–ç‰‡å¡«æ»¿æ•´å€‹å€åŸŸä¸”ä¸è®Šå½¢ */
        background-size: contain;
    
        /* 3. åœ–ç‰‡ç½®ä¸­é¡¯ç¤º */
        background-position: center;
    
        /* 4. æ»¾å‹•æ™‚åœ–ç‰‡å›ºå®šï¼ˆç”¢ç”Ÿè¦–å·®æ•ˆæœï¼‰ï¼Œè‹¥ä¸å–œæ­¡å¯æ”¹ç‚º scroll */
        background-attachment: fixed;
    
        /* ä»¥ä¸‹ç¶­æŒåŸç‹€ */
        height: 600px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        color: white;
        position: relative;
        overflow: hidden;
        }

        .hero-content {
            z-index: 2;
            animation: slideInDown 1s ease-out;
        }

        .hero h1 {
            font-size: 56px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .hero p {
            font-size: 24px;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .cta-button {
            background: var(--primary-color);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .cta-button:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }

        /* ========== ç†±éŠ·ç”¢å“å€ ========== */
        .featured-section {
            padding: 60px 20px;
            background: white;
            text-align: center;
        }

        .section-title {
            font-size: 36px;
            margin-bottom: 50px;
            color: var(--dark-color);
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        /* ä¿®æ”¹ï¼šç†±éŠ·ç”¢å“å¡ç‰‡å¯¬åº¦ï¼Œç¢ºä¿ä¸€åˆ—é¡¯ç¤º 4 å€‹ (æ‰£é™¤ gap) */
        .featured-products .product-card {
            flex: 0 0 calc(25% - 23px); /* 25% å¯¬åº¦æ¸›å»é–“è·è£œå„Ÿ */
            min-width: 250px; /* ä¿æŒæœ€å°å¯¬åº¦é˜²æ­¢è®Šå½¢ */
        }

        /* æ‰‹æ©Ÿèˆ‡å¹³æ¿é©æ‡‰ */
        @media (max-width: 1100px) {
            .featured-products .product-card { flex: 0 0 calc(33.33% - 20px); } /* é¡¯ç¤º 3 å€‹ */
        }
        @media (max-width: 850px) {
        .featured-products .product-card { flex: 0 0 calc(50% - 15px); } /* é¡¯ç¤º 2 å€‹ */
        }
        @media (max-width: 600px) {
            .featured-products .product-card { flex: 0 0 100%; } /* é¡¯ç¤º 1 å€‹ */
        }
        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .product-image {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            position: relative;
            overflow: hidden;
        }

        .product-info {
            padding: 20px;
        }

        .add-to-cart-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* ========== åˆ†é¡å€ ========== */
        .categories-section {
            padding: 60px 20px;
            background: #f8f9fa;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .category-card {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--box-shadow);
        }

        .category-card:hover {
            background: var(--primary-color); color: white; transform: scale(1.05);
        }

        /* ========== ä¸»å®¹å™¨ ========== */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
            min-height: 600px;
        }

        /* ========== å´é‚Šæ¬„ç¯©é¸ ========== */
        .sidebar {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            height: fit-content;
            position: sticky;
            top: 80px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .price-range input {
            width: 100%;
        }

        /* ========== æ¨¡æ…‹æ¡†ç³»çµ± ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 450px;
            padding: 30px;
            position: relative;
            animation: slideUp 0.3s ease-out;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            cursor: pointer;
            background: none;
            border: none;
            color: #999;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-secondary { background: #ddd; color: var(--dark-color); }

        /* ========== é€šçŸ¥ ========== */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            z-index: 3000;
            animation: slideInDown 0.3s ease-out;
        }
        .notification.success { background: #2ecc71; }
        .notification.error { background: #e74c3c; }

        /* è¼ªæ’­ç®­é ­æ¨£å¼ */
.nav-arrow {
    position: absolute;
    top: 55%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.3);
    color: white;
    border: none;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    z-index: 10;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}
.nav-arrow:hover { background: var(--primary-color); }

/* ä¿®æ”¹ç†±éŠ·ç”¢å“å®¹å™¨ç‚ºæ»‘è»Œæ¨¡å¼ */
.featured-products .product-card {
    flex: 0 0 calc(25% - 23px); /* æ¯æ¬¡é¡¯ç¤º 4 å€‹å¡ç‰‡ */
    min-width: 250px;
}

@media (max-width: 992px) {
    .featured-products .product-card { flex: 0 0 calc(50% - 15px); } /* è¢å¹•å°æ–¼ 992px é¡¯ç¤º 2 å€‹ */
}
@media (max-width: 600px) {
    .featured-products .product-card { flex: 0 0 100%; } /* æ‰‹æ©Ÿç‰ˆé¡¯ç¤º 1 å€‹ */
}
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="announcement-bar">
        <div class="announcement-content">
            âœ¨ æ­¡è¿å…‰è‡¨ UHS æ™‚å°šæœé£¾åº—ï¼ &nbsp;&nbsp;&nbsp;&nbsp; ğŸšš å…¨é¤¨æ»¿ 4 ä»¶è¡£æœäº«å…é‹å„ªæƒ ï¼ &nbsp;&nbsp;&nbsp;&nbsp; ğŸ‚ ç§‹å†¬æ–°å“ç¬¬äºŒä»¶äº« 8 æŠ˜å„ªæƒ ï¼ &nbsp;&nbsp;&nbsp;&nbsp; ğŸ“… æ¯æ—¥ç°½åˆ°é ˜å¥½ç¦®ï¼
        </div>
    </div>

    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo" onclick="goToHome()" style="cursor: pointer; display: flex; align-items: center; gap: 10px;">
                <span>ğŸ‘— UHS æ™‚å°šæœé£¾åº—</span>
            </div>
            <div class="nav-links">
                <a href="#" onclick="goToHome(); return false;">é¦–é </a>
                <a href="#" onclick="goToShop(); return false;">å•†å“</a>
                <a href="#" onclick="goToResale(); return false;">â™»ï¸ äºŒæ‰‹è½‰è®“</a>
                <a href="#" onclick="openSizeAssistant(); return false;">ğŸ“ å°ºç¢¼åŠ©æ‰‹</a>
                <a href="#" onclick="openContactModal(); return false;">ğŸ’¬ ç•™è¨€</a>
                <a href="#" onclick="openCheckIn(); return false;">ğŸ“… ç°½åˆ°</a>
                <a href="#" onclick="openLuckyWheel(); return false;">ğŸ¡ æ¯æ—¥ä¸€æŠ½</a>
                <button onclick="openCart()">
                    <span class="cart-icon">ğŸ›’
                        <span class="cart-count" id="cartCount">0</span>
                    </span>
                </button>
                <button onclick="openLogin()" id="loginBtn">ç™»å…¥/è¨»å†Š</button>
                
                <div class="user-dropdown" id="userArea" style="display: none;">
                    <button class="user-display-btn" id="userDisplay" onclick="toggleUserDropdown()">
                        <span id="rankBadge" class="rank-badge rank-silver">éŠ€å¡</span>
                        ğŸ‘¤ æœƒå“¡åç¨±
                    </button>
                    <div class="dropdown-menu" id="userDropdown">
                        <a href="#" onclick="openUserInfo(); return false;">ğŸ“ æœƒå“¡è³‡è¨Š</a>
                        <a href="#" onclick="showPointsNotification(); return false;">ğŸ’° æˆ‘çš„æœƒå“¡é»æ•¸</a>
                        <a href="#" onclick="openCoupons(); return false;">ğŸŸï¸ æˆ‘çš„å„ªæƒ åˆ¸</a>
                        <a href="#" onclick="logout(); return false;">ğŸšª ç™»å‡º</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div id="resalePage" style="display: none;">
        <div class="resale-container">
            <h2 style="margin-bottom: 10px;">â™»ï¸ è³£äºŒæ‰‹è¡£ç‰©</h2>
            <p style="color: #666; margin-bottom: 25px;">æ”¯æŒæ°¸çºŒæ™‚å°šï¼æˆåŠŸæäº¤äºŒæ‰‹è¡£ç‰©è³‡è¨Šå¾Œï¼Œå³å¯ç²å¾— 200 é»æœƒå“¡é»æ•¸ã€‚</p>
            
            <div class="resale-form-group">
                <label>è¡£ç‰©åç¨±</label>
                <input type="text" id="resaleItemName" placeholder="ä¾‹å¦‚ï¼šUHS ç‰›ä»”å¤–å¥—">
            </div>
            
            <div class="resale-form-group">
                <label>è¡£ç‰©åˆ†é¡</label>
                <select id="resaleCategory" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:4px;">
                    <option value="è¡£æœ">è¡£æœ</option>
                    <option value="è¤²å­">è¤²å­</option>
                    <option value="å¤–å¥—">å¤–å¥—</option>
                    <option value="é…ä»¶">é…ä»¶</option>
                </select>
            </div>

            <div class="resale-form-group">
                <label>ä¸Šå‚³è¡£æœåœ–ç‰‡</label>
                <input type="file" id="resaleImage" accept="image/*" onchange="previewResaleImage(this)" style="padding: 5px;">
                <img id="resaleImagePreview" class="resale-image-preview">
            </div>

            <div class="resale-form-group">
                <label>ä½¿ç”¨ç‹€æ³æè¿°</label>
                <textarea id="resaleDescription" rows="4" placeholder="è«‹ç°¡å–®æè¿°è¡£ç‰©ç‹€æ³ (ä¾‹å¦‚ï¼šä¹æˆæ–°ã€ç„¡æ±™é»)..."></textarea>
            </div>

            <button class="btn btn-primary" onclick="submitResaleClothes()" style="width: 100%;">æäº¤è³‡è¨Šä¸¦é ˜å– 200 é»æ•¸</button>
            <button class="btn btn-secondary" onclick="goToHome()" style="width: 100%; margin-top: 10px;">è¿”å›é¦–é </button>
        </div>
    </div>

    <div class="modal-overlay" id="sizeModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('sizeModal')">âœ•</button>
            <h2>ğŸ“ å°ºç¢¼æ™ºèƒ½åŠ©æ‰‹</h2>
            <div style="margin-top: 20px;">
                <input type="number" id="userHeight" placeholder="è«‹è¼¸å…¥èº«é«˜ (cm)" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
                <input type="number" id="userWeight" placeholder="è«‹è¼¸å…¥é«”é‡ (kg)" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
                <button class="btn btn-primary" onclick="calculateSize()" style="width: 100%;">é–‹å§‹åˆ†æ</button>
                <div id="sizeResult" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px; display: none; text-align: center;">
                    <p style="font-size: 14px;">å»ºè­°æ‚¨çš„åˆé©å°ºç¢¼ç‚ºï¼š</p>
                    <p id="suggestedSize" style="font-size: 24px; font-weight: bold; color: var(--primary-color);"></p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="contactModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('contactModal')">âœ•</button>
            <h2>ğŸ“§ è¯ç¹«å®˜æ–¹ä¿¡ç®±</h2>
            <p style="font-size: 14px; color: #666; margin-bottom: 15px;">å¦‚æœæ‚¨æœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°ï¼Œæ­¡è¿ç•™è¨€çµ¦æˆ‘å€‘ï¼</p>
            <div style="margin-top: 10px;">
                <input type="text" id="contactSubject" placeholder="ä¸»æ—¨" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
                <textarea id="contactMessage" placeholder="è«‹è¼¸å…¥æ‚¨çš„ç•™è¨€å…§å®¹..." style="width:100%; padding:12px; height: 150px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px; font-family: inherit; resize: none;"></textarea>
                <button class="btn btn-primary" onclick="submitContactMessage()" style="width: 100%;">ç™¼é€ç•™è¨€</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="userInfoModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('userInfoModal')">âœ•</button>
            <h2>ğŸ“ æœƒå“¡è³‡è¨Šä¿®æ”¹</h2>
            <div style="margin-top: 20px;">
                <p style="font-size: 14px; color: #666; margin-bottom: 5px;">å¸³è™Ÿ (Email):</p>
                <p id="infoEmail" style="font-weight: bold; margin-bottom: 15px; color: var(--dark-color);"></p>
                
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 5px;">
                    <p style="font-size: 14px; color: #666;">ç´¯è¨ˆæ¶ˆè²»é‡‘é¡:</p>
                    <p style="font-size: 11px; color: #999;">(é‡‘å¡:$5,000 / é‘½çŸ³å¡:$15,000)</p>
                </div>
                <p id="infoTotalSpent" style="font-weight: bold; margin-bottom: 15px; color: var(--primary-color); font-size: 1.2em;">$0</p>
                
                <input type="text" id="updateName" placeholder="ä¿®æ”¹å§“å" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
                <input type="password" id="updatePassword" placeholder="ä¿®æ”¹å¯†ç¢¼ (ç•™ç©ºå‰‡ä¸æ›´å‹•)" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
                
                <button class="btn btn-primary" onclick="processUpdateInfo()" style="width: 100%;">å„²å­˜ä¿®æ”¹</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="couponsModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('couponsModal')">âœ•</button>
            <h2>ğŸŸï¸ æˆ‘çš„å„ªæƒ åˆ¸</h2>
            <div id="couponsList" style="margin-top: 20px; max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <div id="homePage">
        <div class="hero">
            <div class="hero-content">
                <h1>æ­¡è¿ä¾†åˆ°UHSæ™‚å°šæœé£¾åº—</h1>
                <p>ç™¼ç¾æ‚¨çš„æ™‚å°šé¢¨æ ¼</p>
                <button class="cta-button" onclick="goToShop()">é–‹å§‹è³¼ç‰©</button>
            </div>
        </div>
        <div class="featured-section">
        <h2 class="section-title">ğŸ”¥ ç†±éŠ·ç”¢å“</h2>
            <div style="position: relative; max-width: 1200px; margin: 0 auto; overflow: hidden;">
                <button class="nav-arrow prev" onclick="moveSlide(-1)" style="left: 10px;">&#10094;</button>
            <div class="featured-products" id="featuredProducts" style="display: flex; gap: 30px; transition: transform 0.5s ease-in-out; margin-top: 40px; justify-content: flex-start;">
            </div>
        <button class="nav-arrow next" onclick="moveSlide(1)" style="right: 10px;">&#10095;</button>
    </div>
        </div>
        <div class="categories-section">
            <div class="categories-container">
                <h2 class="section-title">ğŸ›ï¸ å•†å“åˆ†é¡</h2>
                <div class="category-grid" id="categoryGrid"></div>
            </div>
        </div>
    </div>

    <div id="shopPage" style="display: none; padding-top: 20px; min-height: 100vh;">
        <div class="main-container">
            <div class="sidebar">
                <div class="filter-title">ğŸ” ç¯©é¸</div>
    
                <div style="margin-bottom: 20px;">
                <input type="text" id="searchInput" placeholder="æœå°‹å•†å“åç¨±..." oninput="filterProducts()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
    <div id="filterCategoryContainer"></div>
    <div class="price-range">
        <p>æœ€é«˜: $<span id="priceValue">2000</span></p>
        <input type="range" id="priceRange" min="0" max="2000" value="2000" onchange="filterProducts()">
    </div>
</div>
            <div class="products-section" id="productsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;"></div>
        </div>
    </div>

    <div class="modal-overlay" id="checkInModal">
        <div class="modal-content" style="text-align: center;">
            <button class="close-btn" onclick="closeCheckIn()">âœ•</button>
            <h2>ğŸ“… æ¯æ—¥ç°½åˆ°</h2>
            <div class="checkin-grid" id="checkInGrid"></div>
            <p>ç›®å‰é»æ•¸ï¼š<span class="points-val">0</span></p>
            <button class="btn btn-primary" id="checkInBtn" onclick="processCheckIn()" style="width:100%; margin-top:10px">ç«‹å³ç°½åˆ°</button>
        </div>
    </div>

    <div class="modal-overlay" id="wheelModal">
        <div class="modal-content" style="text-align: center; max-width: 500px;">
            <button class="close-btn" onclick="closeLuckyWheel()">âœ•</button>
            <h2>ğŸ¡ æ¯æ—¥å¹¸é‹ä¸€æŠ½</h2>
            <p style="font-size: 14px; color: #666; margin-bottom: 10px;">æ¯å¤©éƒ½æœ‰ä¸€æ¬¡å…è²»è©¦æ‰‹æ°£çš„æ©Ÿæœƒï¼</p>
            <div style="position: relative; width: 300px; margin: 0 auto;">
                <div class="wheel-pointer"></div>
                <div class="wheel-container" id="wheel"></div>
            </div>
            <button class="btn btn-primary" id="spinBtn" onclick="spinWheel()" style="width:100%; margin-top:20px; background: #f39c12;">ç«‹å³æŠ½ç</button>
        </div>
    </div>

<div class="modal-overlay" id="cartModal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeCart()">âœ•</button>
        <h2>ğŸ›’ è³¼ç‰©è»Šçµå¸³</h2>
        <div id="cartItems" style="margin:15px 0"></div>
        
        <div style="margin-bottom: 10px; padding: 10px; background: #f0f2f5; border-radius: 4px;">
            <label style="font-size: 13px; font-weight: bold; display: block; margin-bottom: 5px;">ğŸŸï¸ ä½¿ç”¨å„ªæƒ åˆ¸ï¼š</label>
            <select id="couponSelector" onchange="displayCart()" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                <option value="-1">ä¸ä½¿ç”¨å„ªæƒ åˆ¸</option>
            </select>
        </div>

        <div style="margin-bottom: 15px; padding: 10px; background: #fff4e5; border-radius: 4px; border: 1px dashed #ffa502;">
            <label style="font-size: 13px; font-weight: bold; display: block; margin-bottom: 2px;">ğŸ’° æœƒå“¡é»æ•¸æŠ˜æŠµ (100é»æŠ˜1å…ƒ)ï¼š</label>
            <p style="font-size: 12px; color: #666; margin-bottom: 5px;">æ‚¨ç›®å‰æ“æœ‰ï¼š<span class="points-val" style="font-weight:bold; color:#e67e22;">0</span> é»</p>
            <div style="display: flex; gap: 5px;">
                <input type="number" id="usePointsAmount" placeholder="è¼¸å…¥é»æ•¸(éœ€ç‚º100å€æ•¸)" oninput="displayCart()" step="100" min="0" style="flex: 1; padding: 8px; margin: 0;">
                <button class="btn btn-secondary" onclick="useMaxPoints()" style="padding: 0 10px; font-size: 12px; white-space: nowrap;">å…¨éƒ¨æŠ˜æŠµ</button>
            </div>
        </div>

        <div id="discountInfo" style="color: var(--primary-color); font-size: 13px; margin-bottom: 5px; font-weight: bold; line-height: 1.4;"></div>
        <p style="text-align:right; font-weight:bold; font-size: 1.2em; border-top: 1px solid #eee; pt: 10px;">ç¸½è¨ˆé‡‘é¡ï¼š<span id="cartTotal">$0</span></p>
        <button class="btn btn-primary" style="width:100%; margin-top:15px; font-size: 18px;" onclick="checkoutProcess()">ç¢ºèªä¸‹å–®ä¸¦æ”¯ä»˜</button>
    </div>
</div>

    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeLogin()">âœ•</button>
            <div id="loginForm">
                <h2>ğŸ” æœƒå“¡ç™»å…¥</h2>
                <input type="email" id="loginEmail" placeholder="é›»å­éƒµä»¶" style="width:100%; padding:12px; margin:15px 0; border:1px solid #ddd; border-radius:4px;">
                <input type="password" id="loginPassword" placeholder="å¯†ç¢¼" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
                <div style="text-align: left; margin-bottom: 15px; font-size: 14px;">
                    <input type="checkbox" id="rememberMe"> <label for="rememberMe">è¨˜ä½æˆ‘çš„å¸³è™Ÿ</label>
                </div>
                <button class="btn btn-primary" onclick="performLogin()" style="width: 100%;">ç™»å…¥</button>
                <p style="margin-top:15px; text-align:center; font-size:14px;">é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿ <a href="#" onclick="toggleAuthForm('register'); return false;">ç«‹å³è¨»å†Š</a></p>
            </div>
            <div id="registerForm" style="display: none;">
                <h2>ğŸ“ è¨»å†Šæ–°æœƒå“¡</h2>
                <input type="text" id="regName" placeholder="å§“å" style="width:100%; padding:12px; margin:15px 0; border:1px solid #ddd; border-radius:4px;">
                <input type="email" id="regEmail" placeholder="é›»å­éƒµä»¶" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
                <input type="password" id="regPassword" placeholder="è¨­å®šå¯†ç¢¼" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
                <button class="btn btn-primary" onclick="performRegister()" style="width: 100%; background:var(--secondary-color)">å®Œæˆè¨»å†Š</button>
                <p style="margin-top:15px; text-align:center; font-size:14px;">å·²æœ‰å¸³è™Ÿï¼Ÿ <a href="#" onclick="toggleAuthForm('login'); return false;">è¿”å›ç™»å…¥</a></p>
            </div>
        </div>
    </div>

    <script>
        const categories = ['å¸½å­', 'è¡£æœ', 'ç‰›ä»”è¤²', 'å¤–å¥—', 'è¤²å­', 'è¥ªå­', 'æ‰‹å¥—'];
        const categoryIcons = ['Cap', 'Shirt', 'Jeans', 'Coat', 'Pants', 'Socks', 'Gloves'];
        let products = [], cart = [], currentUser = null, filteredProducts = [];
        let checkInData = { lastCheckIn: null, streak: 0, points: 0, coupons: [], lastWheelDate: null };

        // çé …é…ç½®
        const prizes = [
            { text: '95æŠ˜åˆ¸', type: 'percent', value: 0.95, color: '#ff9ff3' },
            { text: 'éŠ˜è¬æƒ é¡§', type: 'none', value: 1, color: '#dfe6e9' },
            { text: '9æŠ˜åˆ¸', type: 'percent', value: 0.9, color: '#54a0ff' },
            { text: 'ç¾é‡‘100', type: 'cash', value: 100, color: '#ff6b6b' },
            { text: '85æŠ˜åˆ¸', type: 'percent', value: 0.85, color: '#feca57' },
            { text: 'ç¾é‡‘50', type: 'cash', value: 50, color: '#1dd1a1' }
        ];

        function init() {
            generateProducts();
            displayFeaturedProducts();
            displayCategories();
            renderFilterCheckboxes();
            displayProducts();
            loadCart();
            renderWheel();
            checkRememberedUser();
        }

        // ========== æœƒå“¡èˆ‡ç™»å…¥é‚è¼¯ ==========
        function toggleAuthForm(type) {
            document.getElementById('loginForm').style.display = type === 'login' ? 'block' : 'none';
            document.getElementById('registerForm').style.display = type === 'register' ? 'block' : 'none';
        }
        
        function checkRememberedUser() {
            const savedEmail = localStorage.getItem('remembered_account');
            if (savedEmail) {
                document.getElementById('loginEmail').value = savedEmail;
                document.getElementById('rememberMe').checked = true;
            }
        }

        function performRegister() {
            const name = document.getElementById('regName').value, email = document.getElementById('regEmail').value, password = document.getElementById('regPassword').value;
            if (!name || !email || !password) return showNotification('è«‹å¡«å¯«å®Œæ•´', 'error');
            if (localStorage.getItem(`user_${email}`)) return showNotification('å¸³è™Ÿå·²å­˜åœ¨', 'error');
            localStorage.setItem(`user_${email}`, JSON.stringify({ name: name, email: email, password: password, totalSpent: 0 }));
            showNotification('è¨»å†ŠæˆåŠŸ'); toggleAuthForm('login');
        }
        
function performLogin() {
            const email = document.getElementById('loginEmail').value, password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const user = JSON.parse(localStorage.getItem(`user_${email}`));
            
            if (!user || user.password !== password) return showNotification('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤', 'error');
            
            if (rememberMe) {
                localStorage.setItem('remembered_account', email);
            } else {
                localStorage.removeItem('remembered_account');
            }

            currentUser = user;
            updateMemberRank();
            document.getElementById('userArea').style.display = 'inline-block';
            document.getElementById('loginBtn').style.display = 'none';
            closeLogin(); 
            loadCheckInData(); 
            
            // é—œéµä¿®æ”¹ï¼šç™»å…¥å¾Œè¼‰å…¥è©²å¸³è™Ÿè³¼ç‰©è»Š
            loadCart(); 
            
            showNotification('ç™»å…¥æˆåŠŸ');
        }
        
function logout() { 
            currentUser = null; 
            cart = []; // é—œéµä¿®æ”¹ï¼šç™»å‡ºæ™‚æ¸…ç©ºè¨˜æ†¶é«”ä¸­çš„è³¼ç‰©è»Š
            localStorage.removeItem('cart'); // æ¸…é™¤æœªç™»å…¥ç‹€æ…‹çš„æš«å­˜
            location.reload(); 
        }

        // ========== ä¸‹æ‹‰é¸å–®èˆ‡ç­‰ç´šåˆ¶æœƒå“¡ ==========
        function toggleUserDropdown() {
            document.getElementById('userDropdown').classList.toggle('show');
        }

        function updateMemberRank() {
            const spent = currentUser.totalSpent || 0;
            const display = document.getElementById('userDisplay');
            
            display.innerHTML = `<span id="rankBadge" class="rank-badge"></span> ğŸ‘¤ ${currentUser.name}`;
            const newBadge = document.getElementById('rankBadge');

            if (spent >= 15000) {
                newBadge.textContent = 'é‘½çŸ³å¡';
                newBadge.className = 'rank-badge rank-diamond';
            } else if (spent >= 5000) {
                newBadge.textContent = 'é‡‘å¡';
                newBadge.className = 'rank-badge rank-gold';
            } else {
                newBadge.textContent = 'éŠ€å¡';
                newBadge.className = 'rank-badge rank-silver';
            }
        }

        function showPointsNotification() {
            showNotification(`ğŸ’° ç›®å‰æœƒå“¡é»æ•¸ï¼š${checkInData.points} é»`, 'success');
            document.getElementById('userDropdown').classList.remove('show');
        }

        function openUserInfo() {
            document.getElementById('infoEmail').textContent = currentUser.email;
            document.getElementById('infoTotalSpent').textContent = `$${currentUser.totalSpent || 0}`;
            document.getElementById('updateName').value = currentUser.name;
            document.getElementById('userInfoModal').classList.add('active');
            document.getElementById('userDropdown').classList.remove('show');
        }

        function processUpdateInfo() {
            const newName = document.getElementById('updateName').value;
            const newPassword = document.getElementById('updatePassword').value;
            
            if(!newName) return showNotification('å§“åä¸èƒ½ç‚ºç©º', 'error');
            
            currentUser.name = newName;
            if(newPassword) currentUser.password = newPassword;
            
            localStorage.setItem(`user_${currentUser.email}`, JSON.stringify(currentUser));
            document.getElementById('userDisplay').textContent = `ğŸ‘¤ ${currentUser.name}`;
            updateMemberRank();
            closeModal('userInfoModal');
            showNotification('æœƒå“¡è³‡æ–™å·²æ›´æ–°');
        }

        function openCoupons() {
            const list = document.getElementById('couponsList');
            const coupons = checkInData.coupons || [];
            
            if(coupons.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:#999; padding:20px;">ç›®å‰å°šç„¡å„ªæƒ åˆ¸</p>';
            } else {
                list.innerHTML = coupons.map(c => `
                    <div style="background:#f9f9f9; border-left:5px solid var(--primary-color); padding:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; border-radius:4px;">
                        <div><span style="font-weight:bold; color:var(--dark-color);">${c.text}</span></div>
                        <span style="background:var(--primary-color); color:white; padding:4px 8px; border-radius:4px; font-size:12px;">æœªä½¿ç”¨</span>
                    </div>`).join('');
            }
            
            document.getElementById('couponsModal').classList.add('active');
            document.getElementById('userDropdown').classList.remove('show');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

// ========== å°è¦½é‚è¼¯ï¼šç¢ºä¿æ¯æ¬¡åˆ‡æ›éƒ½éš±è—æ‰€æœ‰åˆ†é  ==========
        function goToHome() {
        document.getElementById('homePage').style.display = 'block';
        document.getElementById('shopPage').style.display = 'none';
        document.getElementById('resalePage').style.display = 'none';
        document.getElementById('miniGamePage').style.display = 'none'; // ç¢ºä¿éŠæˆ²é è¢«éš±è—
        window.scrollTo(0,0);
        }
        function goToShop() {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('shopPage').style.display = 'block';
            document.getElementById('resalePage').style.display = 'none';
            document.getElementById('miniGamePage').style.display = 'none'; // éš±è—éŠæˆ²
            window.scrollTo(0,0);
        }
        function goToResale() {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('shopPage').style.display = 'none';
            document.getElementById('resalePage').style.display = 'block';
            document.getElementById('miniGamePage').style.display = 'none'; // éš±è—éŠæˆ²
            window.scrollTo(0,0);
        }
        // ========== äºŒæ‰‹è½‰è®“é‚è¼¯ ==========
        function previewResaleImage(input) {
            const preview = document.getElementById('resaleImagePreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function submitResaleClothes() {
            if (!currentUser) return (showNotification('è«‹å…ˆç™»å…¥æ‰èƒ½è½‰è®“è¡£ç‰©', 'error'), openLogin());
            
            const name = document.getElementById('resaleItemName').value;
            const desc = document.getElementById('resaleDescription').value;
            const img = document.getElementById('resaleImage').value;
            
            if (!name || !desc) return showNotification('è«‹è¼¸å…¥å®Œæ•´çš„è¡£ç‰©è³‡è¨Š', 'error');
            if (!img) return showNotification('è«‹ä¸Šå‚³ä¸€å¼µè¡£ç‰©åœ–ç‰‡', 'error');

            // å¢åŠ  200 é»
            checkInData.points += 200;
            saveCheckInData();

            showNotification('æäº¤æˆåŠŸï¼æ„Ÿè¬æ”¯æŒæ°¸çºŒæ™‚å°šï¼Œ200 é»æ•¸å·²åŒ¯å…¥å¸³è™Ÿã€‚', 'success');
            
            // é‡ç½®è¡¨å–®ä¸¦å›é¦–é 
            document.getElementById('resaleItemName').value = '';
            document.getElementById('resaleDescription').value = '';
            document.getElementById('resaleImage').value = '';
            document.getElementById('resaleImagePreview').style.display = 'none';
            goToHome();
        }

        // ========== å°ºç¢¼åŠ©æ‰‹é‚è¼¯ ==========
        function openSizeAssistant() {
            document.getElementById('sizeResult').style.display = 'none';
            document.getElementById('sizeModal').classList.add('active');
        }

        function calculateSize() {
            const h = parseFloat(document.getElementById('userHeight').value);
            const w = parseFloat(document.getElementById('userWeight').value);
            if (!h || !w) return showNotification('è«‹è¼¸å…¥å®Œæ•´çš„æ•¸æ“š', 'error');

            const bmi = w / ((h / 100) ** 2);
            let size = bmi < 23 ? "M" : "L";
            document.getElementById('suggestedSize').textContent = size;
            document.getElementById('sizeResult').style.display = 'block';
        }

        // ========== è¯ç¹«å®˜æ–¹é‚è¼¯ ==========
        function openContactModal() {
            document.getElementById('contactModal').classList.add('active');
        }

        function submitContactMessage() {
            showNotification('ç•™è¨€ç™¼é€æˆåŠŸ');
            closeModal('contactModal');
        }

        let currentSlide = 0;
let autoSlideTimer;

// ä¿®æ”¹ï¼šé¸å–å‰ 8 å€‹å•†å“ä¾†åšè¼ªæ’­ (4å€‹çœ‹å¾—åˆ°ï¼Œ4å€‹åœ¨æ—é‚Šé å‚™)
function displayFeaturedProducts() {
    const featuredContainer = document.getElementById('featuredProducts');
    
    // é€™è£¡æ”¹ç‚ºé¸å– 8 å€‹å•†å“
    const featuredItems = products.slice(0, 8); 
    
    featuredContainer.innerHTML = featuredItems.map(p => `
        <div class="product-card">
            <div class="product-image">${p.category}</div>
            <div class="product-info">
                <h3>${p.name}</h3>
                <p>$${p.price}</p>
                <button class="add-to-cart-btn" onclick="addToCart(${p.id})">åŠ å…¥è³¼ç‰©è»Š</button>
            </div>
        </div>`).join('');
    
    // å•Ÿå‹•è¼ªæ’­
    resetAutoSlide(); 
}

// ä¿®æ­£ï¼šç§»å‹•é‚è¼¯ (ç¢ºä¿è¨ˆç®— visibleCards æ­£ç¢º)
function moveSlide(direction) {
    const container = document.getElementById('featuredProducts');
    const cards = container.getElementsByClassName('product-card');
    if (cards.length === 0) return;

    // æ ¹æ“šç›®å‰çš„è¦–çª—å¯¬åº¦åˆ¤æ–·ã€Œç¾åœ¨çœ‹å¾—åˆ°å¹¾å€‹ã€
    let visibleCards = 4;
    if (window.innerWidth <= 600) visibleCards = 1;
    else if (window.innerWidth <= 850) visibleCards = 2;
    else if (window.innerWidth <= 1100) visibleCards = 3;

    const maxSlide = cards.length - visibleCards;

    currentSlide += direction;

    // å¾ªç’°æ»¾å‹•é‚è¼¯
    if (currentSlide > maxSlide) currentSlide = 0;
    if (currentSlide < 0) currentSlide = maxSlide;

    // ç²å–ç¬¬ä¸€å¼µå¡ç‰‡çš„å¯¦éš›å¯¬åº¦(å«å¤–é‚Šè·)
    const cardWidth = cards[0].getBoundingClientRect().width + 30; 
    container.style.transform = `translateX(${-currentSlide * cardWidth}px)`;
}

// è‡ªå‹•è¼ªæ’­åŠŸèƒ½
function startAutoSlide() {
    autoSlideTimer = setInterval(() => {
        moveSlide(1);
    }, 4000); // æ¯ 4 ç§’æ²å‹•ä¸€æ¬¡
}

function resetAutoSlide() {
    clearInterval(autoSlideTimer);
    startAutoSlide();
}

// ç›£è½è¦–çª—å¤§å°æ”¹è®Šï¼Œé¿å…æ’ç‰ˆè·‘æ‰
window.addEventListener('resize', () => {
    currentSlide = 0;
    document.getElementById('featuredProducts').style.transform = `translateX(0)`;
});

        // ========== ç°½åˆ°èˆ‡é»æ•¸é‚è¼¯ ==========
        function loadCheckInData() {
            const saved = localStorage.getItem(`checkIn_${currentUser.email}`);
            checkInData = saved ? JSON.parse(saved) : { lastCheckIn: null, streak: 0, points: 0, coupons: [], lastWheelDate: null };
            document.querySelectorAll('.points-val').forEach(el => el.textContent = checkInData.points);
        }
        function openCheckIn() {
            if (!currentUser) return openLogin();
            loadCheckInData(); renderCheckInGrid();
            document.getElementById('checkInModal').classList.add('active');
        }
        function closeCheckIn() { document.getElementById('checkInModal').classList.remove('active'); }
        function renderCheckInGrid() {
            const grid = document.getElementById('checkInGrid');
            const streak = checkInData.streak % 7 || (checkInData.streak > 0 ? 7 : 0);
            grid.innerHTML = Array.from({length:7}, (_, i) => `<div class="checkin-day ${i < streak ? 'completed' : ''}">D${i+1}<br>ğŸ’°</div>`).join('');
            document.getElementById('checkInBtn').disabled = isTodayChecked();
        }
        function isTodayChecked() { return checkInData.lastCheckIn && new Date(checkInData.lastCheckIn).toDateString() === new Date().toDateString(); }
        function processCheckIn() {
            checkInData.streak++;
            checkInData.points += (checkInData.streak % 7 || 7) * 10;
            checkInData.lastCheckIn = new Date().toISOString();
            saveCheckInData(); showNotification('ç°½åˆ°æˆåŠŸ'); renderCheckInGrid();
        }
        function saveCheckInData() {
            localStorage.setItem(`checkIn_${currentUser.email}`, JSON.stringify(checkInData));
            document.querySelectorAll('.points-val').forEach(el => el.textContent = checkInData.points);
        }

        // ========== æŠ½çè½‰ç›¤é‚è¼¯ ==========
        function renderWheel() {
            const wheel = document.getElementById('wheel');
            const numPrizes = prizes.length;
            const deg = 360 / numPrizes; 
            wheel.innerHTML = prizes.map((p, i) => {
                const rotateDeg = i * deg;
                return `
                    <div style="position: absolute; width: 50%; height: 50%; background: ${p.color}; transform-origin: 100% 100%; transform: rotate(${rotateDeg}deg) skewY(${90 - deg}deg); border: 1px solid rgba(255,255,255,0.3); left: 0; top: 0;"></div>
                    <div style="position: absolute; width: 100%; height: 100%; text-align: center; top: 0; left: 0; transform: rotate(${rotateDeg + deg/2}deg); padding-top: 35px; font-size: 13px; font-weight: bold; color: #333; pointer-events: none; z-index: 5;">${p.text}</div>
                `;
            }).join('');
        }

        function isWheelChecked() { 
            if (!checkInData.lastWheelDate) return false;
            return new Date(checkInData.lastWheelDate).toDateString() === new Date().toDateString(); 
        }
        
        function openLuckyWheel() {
            if (!currentUser) return openLogin();
            loadCheckInData();
            const btn = document.getElementById('spinBtn');
            const alreadySpun = isWheelChecked();
            btn.disabled = alreadySpun;
            btn.textContent = alreadySpun ? 'ä»Šæ—¥æŠ½çå·²å®Œæˆ' : 'ç«‹å³æŠ½ç';
            btn.style.opacity = alreadySpun ? '0.5' : '1';
            document.getElementById('wheelModal').classList.add('active');
        }

        function closeLuckyWheel() { document.getElementById('wheelModal').classList.remove('active'); }
        
        function spinWheel() {
            if (isWheelChecked()) return;
            const btn = document.getElementById('spinBtn');
            btn.disabled = true; 
            const randomIndex = Math.floor(Math.random() * prizes.length);
            const extraDeg = 360 * 5; 
            const degPerPrize = 360 / prizes.length;
            const targetDeg = extraDeg + (360 - (randomIndex * degPerPrize) - (degPerPrize / 2));
            const wheel = document.getElementById('wheel');
            
            wheel.style.transition = 'transform 4s cubic-bezier(0.15, 0, 0.15, 1)';
            wheel.style.transform = `rotate(${targetDeg}deg)`;
            
            checkInData.lastWheelDate = new Date().toISOString();
            saveCheckInData();

            setTimeout(() => {
                const prize = prizes[randomIndex];
                if (prize.type !== 'none') {
                    checkInData.coupons.push(prize); 
                    showNotification(`ğŸ‰ æ­å–œï¼æŠ½ä¸­çé …ï¼šã€${prize.text}ã€‘ï¼Œå·²å­˜å…¥å€‹äººå„ªæƒ åˆ¸ã€‚`, 'success');
                } else {
                    showNotification(`å“å‘€ï¼æœ¬æ¬¡çµæœç‚ºï¼šã€${prize.text}ã€‘`, 'error');
                }
                saveCheckInData();
                btn.textContent = 'ä»Šæ—¥æŠ½çå·²å®Œæˆ';
                btn.style.opacity = '0.5';
                const finalDeg = targetDeg % 360;
                wheel.style.transition = 'none';
                wheel.style.transform = `rotate(${finalDeg}deg)`;
            }, 4000);
        }

        // ========== å•†å“èˆ‡è³¼ç‰©è»Šé‚è¼¯ ==========
        function generateProducts() {
    let id = 1;
    categories.forEach(cat => {
        for (let i = 1; i <= 6; i++) {
            // å®šç¾©åœ–ç‰‡è·¯å¾‘ï¼šå‡è¨­æ‚¨çš„åœ–ç‰‡å‘½åç‚º åˆ†é¡+æ•¸å­—.jpg (ä¾‹å¦‚: å¸½å­1.jpg)
            // å¦‚æœæ‚¨é‚„æ²’æº–å‚™å¥½åœ–ç‰‡ï¼Œé€™è£¡å¯ä»¥å…ˆæ”¾æ‚¨çš„æª”å
            let imgPath = `${cat}${i}.jpg`; 
            console.log(imgPath);

            products.push({ 
                id: id++, 
                name: `${cat} å–®å“ #${i}`, 
                category: cat, 
                price: Math.floor(Math.random() * 1500) + 300, 
                isFeatured: i === 1,
                image: imgPath // æ–°å¢åœ–ç‰‡å±¬æ€§
            });
        }
    });
    filteredProducts = [...products];
}
        function openCart() { displayCart(); document.getElementById('cartModal').classList.add('active'); }
        function closeCart() { document.getElementById('cartModal').classList.remove('active'); }
        
        function getCartFinalTotal() {
            const subtotal = cart.reduce((a, b) => a + (b.price * b.quantity), 0);
            let bestPrice = subtotal;
            if (currentUser && checkInData.coupons.length > 0) {
                checkInData.coupons.forEach(coupon => {
                    let currentPrice = subtotal;
                    if (coupon.type === 'percent') currentPrice = Math.floor(subtotal * coupon.value);
                    else if (coupon.type === 'cash') currentPrice = Math.max(0, subtotal - coupon.value);
                    if (currentPrice < bestPrice) bestPrice = currentPrice;
                });
            }
            return bestPrice;
        }

        function displayCart() {
            const container = document.getElementById('cartItems');
            const subtotal = cart.reduce((a, b) => a + (b.price * b.quantity), 0);
            let bestPrice = subtotal;
            let appliedCoupon = null;

            if (currentUser && checkInData.coupons.length > 0) {
                checkInData.coupons.forEach(coupon => {
                    let currentPrice = subtotal;
                    if (coupon.type === 'percent') {
                        currentPrice = Math.floor(subtotal * coupon.value);
                    } else if (coupon.type === 'cash') {
                        currentPrice = Math.max(0, subtotal - coupon.value);
                    }
                    if (currentPrice < bestPrice) {
                        bestPrice = currentPrice;
                        appliedCoupon = coupon;
                    }
                });
            }
            container.innerHTML = cart.length ? cart.map(item => `<div style="display:flex; justify-content:space-between; margin-bottom:5px"><span>${item.name} x ${item.quantity}</span><span>$${item.price * item.quantity}</span></div>`).join('') : 'è³¼ç‰©è»Šç©ºç©ºçš„';
            const discInfo = document.getElementById('discountInfo');
            if (appliedCoupon) {
                discInfo.textContent = `âœ¨ å·²è‡ªå‹•å¥—ç”¨æœ€ä½³å„ªæƒ ï¼š${appliedCoupon.text}`;
                document.getElementById('cartTotal').innerHTML = `<del style="color:#999; font-size:14px; margin-right:10px">$${subtotal}</del> $${bestPrice}`;
            } else {
                discInfo.textContent = '';
                document.getElementById('cartTotal').textContent = `$${subtotal}`;
            }
        }

        function checkoutProcess() {
            if (cart.length === 0) return showNotification('è³¼ç‰©è»Šæ˜¯ç©ºçš„', 'error');
            const total = getCartFinalTotal();
            currentUser.totalSpent = (currentUser.totalSpent || 0) + total;
            localStorage.setItem(`user_${currentUser.email}`, JSON.stringify(currentUser));
            updateMemberRank();
            cart = [];
            saveCart();
            closeCart();
            showNotification(`çµå¸³æˆåŠŸï¼æœ¬æ¬¡æ¶ˆè²» $${total}ï¼Œå·²ç´¯è¨ˆè‡³æœƒå“¡é–€æª»ã€‚`, 'success');
        }

        function addToCart(id) {
            if (!currentUser) return openLogin();
            const p = products.find(x => x.id === id);
            const item = cart.find(x => x.id === id);
            if (item) item.quantity++; else cart.push({ ...p, quantity: 1 });
            saveCart(); showNotification('å·²åŠ å…¥è³¼ç‰©è»Š');
        }
function saveCart() { 
            if (currentUser) {
                localStorage.setItem(`cart_${currentUser.email}`, JSON.stringify(cart)); 
            } else {
                localStorage.removeItem('cart'); // æœªç™»å…¥å‰‡æ¸…ç©ºé€šç”¨æš«å­˜
            }
            document.getElementById('cartCount').textContent = cart.reduce((a, b) => a + b.quantity, 0); 
        }
// ä¿®æ”¹ï¼šè¼‰å…¥è©²å¸³è™Ÿå°ˆå±¬çš„è³¼ç‰©è»Š
        function loadCart() { 
            if (currentUser) {
                const s = localStorage.getItem(`cart_${currentUser.email}`); 
                cart = s ? JSON.parse(s) : []; 
            } else {
                cart = []; 
            }
            document.getElementById('cartCount').textContent = cart.reduce((a, b) => a + b.quantity, 0);
        }

        function displayFeaturedProducts() {
        const featuredContainer = document.getElementById('featuredProducts');
        const featuredItems = products.filter(p => p.isFeatured).slice(0, 8); 
    
        featuredContainer.innerHTML = featuredItems.map(p => `
        <div class="product-card">
            <div class="product-image" style="background: white;">
                <img src="${p.image}" alt="${p.name}" style="width:100%; height:100%; object-fit:cover;">
            </div>
            <div class="product-info">
                <h3>${p.name}</h3>
                <p>$${p.price}</p>
                <button class="add-to-cart-btn" onclick="addToCart(${p.id})">åŠ å…¥è³¼ç‰©è»Š</button>
            </div>
        </div>`).join('');
    
        resetAutoSlide(); 
        }
        function displayCategories() {
            document.getElementById('categoryGrid').innerHTML = categories.map((cat, i) => `<div class="category-card" onclick="filterByCategory('${cat}')"><h1>${categoryIcons[i]}</h1><p>${cat}</p></div>`).join('');
        }
        function renderFilterCheckboxes() {
            document.getElementById('filterCategoryContainer').innerHTML = categories.map(cat => `<div class="filter-option"><input type="checkbox" class="cat-check" id="cat-${cat}" onchange="filterProducts()"><label>${cat}</label></div>`).join('');
        }
        function displayProducts() {
    document.getElementById('productsGrid').innerHTML = filteredProducts.map(p => `
        <div class="product-card">
            <div class="product-image" style="background: white;">
                <img src="${p.image}" alt="${p.name}" style="width:100%; height:100%; object-fit:cover;">
            </div>
            <div class="product-info">
                <h3>${p.name}</h3>
                <p>$${p.price}</p>
                <button class="add-to-cart-btn" onclick="addToCart(${p.id})">åŠ å…¥è³¼ç‰©è»Š</button>
            </div>
        </div>`).join('');
}
        function filterProducts() {
            // ç²å–æ‰€æœ‰éæ¿¾æ¢ä»¶çš„å€¼
            const max = document.getElementById('priceRange').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase(); // é—œéµå­—
            const checkedCategories = Array.from(document.querySelectorAll('.cat-check:checked'))
                                           .map(el => el.id.replace('cat-', ''));
            
            document.getElementById('priceValue').textContent = max;

            // åŸ·è¡Œè¤‡åˆéæ¿¾
            filteredProducts = products.filter(p => {
                const matchesPrice = p.price <= max;
                const matchesCategory = checkedCategories.length === 0 || checkedCategories.includes(p.category);
                const matchesSearch = p.name.toLowerCase().includes(searchTerm); // é—œéµå­—éæ¿¾
                
                return matchesPrice && matchesCategory && matchesSearch;
            });

            displayProducts();
        }
        function filterByCategory(cat) { goToShop(); document.querySelectorAll('.cat-check').forEach(el => el.checked = el.id === `cat-${cat}`); filterProducts(); }
        function openLogin() { document.getElementById('loginModal').classList.add('active'); toggleAuthForm('login'); }
        function closeLogin() { document.getElementById('loginModal').classList.remove('active'); }
        function showNotification(msg, type = 'success') {
            const d = document.createElement('div'); d.className = `notification ${type}`; d.textContent = msg;
            document.body.appendChild(d); setTimeout(() => d.remove(), 2500);
        }

        window.onclick = e => { 
            if (e.target.classList.contains('modal-overlay')) { 
                closeCart(); closeLogin(); closeCheckIn(); closeLuckyWheel(); 
                closeModal('userInfoModal'); closeModal('couponsModal'); closeModal('sizeModal'); closeModal('contactModal');
            } 
            if (!e.target.closest('.user-dropdown')) {
                const dropdown = document.getElementById('userDropdown');
                if (dropdown && dropdown.classList.contains('show')) dropdown.classList.remove('show');
            }
        };

        init();
        
    </script>
    <style>
    /* éŠæˆ²é é¢å®¹å™¨ - ç¨ç«‹æ–¼åŸæœ‰çš„é é¢ */
    #miniGamePage {
        display: none;
        padding: 40px 20px;
        min-height: 100vh;
        background-color: #f8f9fa;
    }
    .game-wrapper {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        text-align: center;
    }
    .game-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin: 25px 0;
    }
    .memory-card-unit {
        aspect-ratio: 1/1;
        background-color: #4ecdc4; /* ä½¿ç”¨æ‚¨çš„ secondary-color */
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        cursor: pointer;
        color: transparent; /* å¹³æ™‚éš±è—æ–‡å­— */
        transition: 0.3s;
        border: 2px solid white;
        user-select: none;
    }
    .memory-card-unit.flipped {
        background-color: white;
        border-color: #4ecdc4;
        color: #333; /* ç¿»é–‹å¾Œé¡¯ç¤ºåœ–æ¨™ */
    }
    .memory-card-unit.matched {
        background-color: #eee;
        color: #ccc;
        cursor: default;
        border-color: #ddd;
    }
</style>

<div id="miniGamePage">
    <div class="game-wrapper">
        <h2>ğŸ® UHS æ™‚å°šè¨˜æ†¶ç¿»ç‰Œè³½</h2>
        <p style="color: #666; margin-top: 10px;">æ‰¾å‡ºå…©å…©æˆå°çš„å–®å“ï¼ŒæˆåŠŸå¯ç²å¾— 100 é»æ•¸ï¼</p>
        <div id="gameGridBox" class="game-grid"></div>
        <button class="btn btn-primary" id="gameActionBtn" onclick="runMemoryGameStart()" style="width: 100%;">é–‹å§‹éŠæˆ²æŒ‘æˆ°</button>
        <button class="btn btn-secondary" onclick="backToMainFromGame()" style="width: 100%; margin-top: 10px;">è¿”å›é¦–é </button>
    </div>
</div>

<script>
    /* 1. è‡ªå‹•æ›è¼‰ï¼šåœ¨ä¸æ”¹å‹•åŸå°èˆªæ¬„ HTML ä¸‹ï¼Œè‡ªå‹•æ’å…¥æŒ‰éˆ• */
    (function injectGameButton() {
        window.addEventListener('load', () => {
            const navLinks = document.querySelector('.nav-links');
            if (navLinks) {
                const gameLink = document.createElement('a');
                gameLink.href = "#";
                gameLink.innerHTML = "ğŸ® å°éŠæˆ²";
                gameLink.id = "extraGameLink";
                gameLink.onclick = function(e) {
                    e.preventDefault();
                    switchToGamePage();
                };
                // æ’å…¥åœ¨ã€Œç°½åˆ°ã€æŒ‰éˆ•å‰é¢ï¼Œä¸ç ´å£åŸçµæ§‹
                navLinks.insertBefore(gameLink, navLinks.firstChild);
            }
        });
    })();

    /* 2. é é¢åˆ‡æ›ï¼šéš±è—åŸæœ‰çš„ï¼Œé¡¯ç¤ºéŠæˆ²çš„ */
/* ä¿®æ”¹ï¼šéŠæˆ²é é¢åˆ‡æ›é‚è¼¯ */
        function switchToGamePage() {
            // éš±è—æ‰€æœ‰å…¶ä»–é é¢
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('shopPage').style.display = 'none';
            document.getElementById('resalePage').style.display = 'none';
            
            // é¡¯ç¤ºéŠæˆ²é 
            document.getElementById('miniGamePage').style.display = 'block';
            initGamePlaceholder();
            window.scrollTo(0,0);
        }

        /* ä¿®æ”¹ï¼šå¾éŠæˆ²è¿”å›é¦–é  */
        function backToMainFromGame() {
            goToHome(); // ç›´æ¥å‘¼å«æ•´åˆå¾Œçš„ goToHome
        }

    /* 3. è¨˜æ†¶éŠæˆ²é‚è¼¯ */
    const fashionIcons = ['ğŸ‘—', 'ğŸ‘•', 'ğŸ‘–', 'ğŸ§¥', 'ğŸ‘ ', 'ğŸ©', 'ğŸ§¤', 'ğŸ‘œ'];
    let gameCardsData = [];
    let flippedIndices = [];
    let solvedPairs = 0;
    let isLocking = false;

    function initGamePlaceholder() {
        document.getElementById('gameGridBox').innerHTML = '<p style="grid-column: span 4; color:#999; padding:20px;">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹</p>';
        document.getElementById('gameActionBtn').style.display = 'block';
    }

    /* 1. è‡ªå‹•æ›è¼‰ï¼šåœ¨å°èˆªæ¬„è‡ªå‹•æ’å…¥ã€Œå°éŠæˆ²ã€æŒ‰éˆ• */
    (function injectGameButton() {
        window.addEventListener('load', () => {
            const navLinks = document.querySelector('.nav-links');
            if (navLinks && !document.getElementById('extraGameLink')) {
                const gameLink = document.createElement('a');
                gameLink.href = "#";
                gameLink.innerHTML = "ğŸ® å°éŠæˆ²";
                gameLink.id = "extraGameLink";
                gameLink.onclick = function(e) {
                    e.preventDefault();
                    switchToGamePage(); // å‘¼å«åˆ‡æ›è‡³éŠæˆ²é é¢çš„å‡½å¼
                };
                // å°‡æŒ‰éˆ•æ’å…¥åœ¨ã€Œç°½åˆ°ã€ä¹‹å‰
                navLinks.insertBefore(gameLink, navLinks.querySelector('a[onclick*="openCheckIn"]') || navLinks.firstChild);
            }
        });
    })();

    function runMemoryGameStart() {
        if (!currentUser) {
            showNotification('è«‹å…ˆç™»å…¥æ‰èƒ½ç²å¾—çå‹µ', 'error');
            openLogin(); // å‘¼å«æ‚¨åŸæœ¬çš„ç™»å…¥æ¡†
            return;
        }

        // æª¢æŸ¥æ˜¯å¦ä»Šå¤©ç©é (å…±ç”¨æ‚¨çš„ checkInData)
        const todayStr = new Date().toDateString();
        if (checkInData.lastGameDate === todayStr) {
            showNotification('ä»Šæ—¥æŒ‘æˆ°å·²é ˜éçå‹µå›‰ï¼', 'error');
            return;
        }

        document.getElementById('gameActionBtn').style.display = 'none';
        gameCardsData = [...fashionIcons, ...fashionIcons].sort(() => Math.random() - 0.5);
        flippedIndices = [];
        solvedPairs = 0;
        isLocking = false;
        
        const grid = document.getElementById('gameGridBox');
        grid.innerHTML = gameCardsData.map((icon, idx) => `
            <div class="memory-card-unit" id="card-unit-${idx}" onclick="handleCardClick(${idx})">${icon}</div>
        `).join('');
    }

    function handleCardClick(idx) {
        const card = document.getElementById(`card-unit-${idx}`);
        if (isLocking || flippedIndices.length === 2 || card.classList.contains('flipped') || card.classList.contains('matched')) return;

        card.classList.add('flipped');
        flippedIndices.push({ idx, icon: gameCardsData[idx] });

        if (flippedIndices.length === 2) {
            isLocking = true;
            setTimeout(checkGameMatchResult, 700);
        }
    }
    
    function checkoutProcess() {
            if (cart.length === 0) return showNotification('è³¼ç‰©è»Šæ˜¯ç©ºçš„', 'error');
            
            const subtotal = cart.reduce((a, b) => a + (b.price * b.quantity), 0);
            let bestPrice = subtotal;
            let appliedCouponIndex = -1; // ç”¨æ–¼è¨˜éŒ„è¢«ä½¿ç”¨çš„å„ªæƒ åˆ¸ç´¢å¼•

            // 1. å°‹æ‰¾æœ€ä½³å„ªæƒ åˆ¸ä¸¦è¨˜éŒ„å…¶ä½ç½®
            if (currentUser && checkInData.coupons.length > 0) {
                checkInData.coupons.forEach((coupon, index) => {
                    let currentPrice = subtotal;
                    if (coupon.type === 'percent') {
                        currentPrice = Math.floor(subtotal * coupon.value);
                    } else if (coupon.type === 'cash') {
                        currentPrice = Math.max(0, subtotal - coupon.value);
                    }
                    
                    if (currentPrice < bestPrice) {
                        bestPrice = currentPrice;
                        appliedCouponIndex = index; // è¨˜éŒ„é€™å¼µåˆ¸çš„ index
                    }
                });
            }

            // 2. æ›´æ–°æœƒå“¡ç´¯è¨ˆæ¶ˆè²»é‡‘é¡
            currentUser.totalSpent = (currentUser.totalSpent || 0) + bestPrice;
            localStorage.setItem(`user_${currentUser.email}`, JSON.stringify(currentUser));
            updateMemberRank();

            // 3. é—œéµä¿®æ”¹ï¼šå¦‚æœä½¿ç”¨äº†å„ªæƒ åˆ¸ï¼Œå°‡å…¶å¾ä½¿ç”¨è€…çš„è³‡æ–™ä¸­ç§»é™¤
            if (appliedCouponIndex !== -1) {
                const usedCouponName = checkInData.coupons[appliedCouponIndex].text;
                checkInData.coupons.splice(appliedCouponIndex, 1); // ç§»é™¤è©²å„ªæƒ åˆ¸
                saveCheckInData(); // å„²å­˜æ›´æ–°å¾Œçš„é»æ•¸èˆ‡å„ªæƒ åˆ¸è³‡æ–™
                console.log(`å·²ä½¿ç”¨ä¸¦ç§»é™¤å„ªæƒ åˆ¸ï¼š${usedCouponName}`);
            }

            // 4. æ¸…ç©ºè³¼ç‰©è»Šèˆ‡å¾ŒçºŒæç¤º
            cart = [];
            saveCart();
            closeCart();
            showNotification(`çµå¸³æˆåŠŸï¼æœ¬æ¬¡å¯¦ä»˜ $${bestPrice}ï¼Œå·²ç§»é™¤ä½¿ç”¨çš„å„ªæƒ åˆ¸ã€‚`, 'success');
        }

    function checkGameMatchResult() {
        const [c1, c2] = flippedIndices;
        const card1 = document.getElementById(`card-unit-${c1.idx}`);
        const card2 = document.getElementById(`card-unit-${c2.idx}`);

        if (c1.icon === c2.icon) {
            card1.classList.add('matched');
            card2.classList.add('matched');
            solvedPairs++;
            if (solvedPairs === fashionIcons.length) {
                // æˆåŠŸï¼šç™¼æ”¾çå‹µ
                checkInData.points += 100;
                checkInData.lastGameDate = new Date().toDateString();
                saveCheckInData(); // å‘¼å«æ‚¨åŸæœ‰çš„å­˜æª” function
                showNotification('ğŸ‰ æŒ‘æˆ°æˆåŠŸï¼ç²å¾— 100 é»æ•¸ï¼', 'success');
                initGamePlaceholder();
            }
        } else {
            card1.classList.remove('flipped');
            card2.classList.remove('flipped');
        }
        flippedIndices = [];
        isLocking = false;
    }
// ä¿®æ”¹ï¼šé¡¯ç¤ºè³¼ç‰©è»Šä¸¦è™•ç†æ‰‹å‹•æŒ‘é¸å„ªæƒ åˆ¸
        window.displayCart = function() {
            const container = document.getElementById('cartItems');
            const selector = document.getElementById('couponSelector');
            const subtotal = cart.reduce((a, b) => a + (b.price * b.quantity), 0);
            
            // æ›´æ–°ä¸‹æ‹‰é¸å–®å…§å®¹ï¼ˆåƒ…åœ¨é–‹å•Ÿè³¼ç‰©è»Šæˆ–æ›´æ–°æ™‚åŸ·è¡Œï¼‰
            const savedCouponIndex = selector.value;
            selector.innerHTML = '<option value="-1">ä¸ä½¿ç”¨å„ªæƒ åˆ¸</option>' + 
                checkInData.coupons.map((c, i) => `<option value="${i}" ${savedCouponIndex == i ? 'selected' : ''}>${c.text}</option>`).join('');

            let finalPrice = subtotal;
            let appliedCoupon = null;
            const selectedIndex = parseInt(selector.value);

            // å¦‚æœä½¿ç”¨è€…é¸äº†æŸå¼µåˆ¸
            if (selectedIndex !== -1 && checkInData.coupons[selectedIndex]) {
                appliedCoupon = checkInData.coupons[selectedIndex];
                if (appliedCoupon.type === 'percent') {
                    finalPrice = Math.floor(subtotal * appliedCoupon.value);
                } else if (appliedCoupon.type === 'cash') {
                    finalPrice = Math.max(0, subtotal - appliedCoupon.value);
                }
            }

            // æ¸²æŸ“å•†å“æ¸…å–® (ä¿ç•™æ‚¨è¦æ±‚çš„åˆªé™¤æŒ‰éˆ•åŠŸèƒ½)
            if (cart.length === 0) {
                container.innerHTML = 'è³¼ç‰©è»Šç©ºç©ºçš„';
            } else {
                container.innerHTML = cart.map((item, index) => `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding-bottom:5px; border-bottom:1px solid #eee">
                        <div style="flex:1">
                            <div style="font-weight:bold">${item.name}</div>
                            <div style="font-size:12px; color:#666">$${item.price} x ${item.quantity}</div>
                        </div>
                        <div style="font-weight:bold; margin-right:15px">$${item.price * item.quantity}</div>
                        <button onclick="removeCartItem(${index})" style="background:#ff4757; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer; font-size:12px">âŒ åˆªé™¤</button>
                    </div>
                `).join('');
            }

            const discInfo = document.getElementById('discountInfo');
            if (appliedCoupon && cart.length > 0) {
                discInfo.textContent = `âœ¨ å·²å¥—ç”¨ï¼š${appliedCoupon.text}`;
                document.getElementById('cartTotal').innerHTML = `<del style="color:#999; font-size:14px; margin-right:10px">$${subtotal}</del> $${finalPrice}`;
            } else {
                discInfo.textContent = '';
                document.getElementById('cartTotal').textContent = `$${subtotal}`;
            }
        };

// 1. æ–°å¢ï¼šé˜²å‘†é©—è­‰å‡½å¼ (é€™æ˜¯è§£æ±ºæ‰“ä¸é–‹çš„é—œéµ)

// è£œå›ï¼šå…¨éƒ¨æŠ˜æŠµæŒ‰éˆ•çš„åŠŸèƒ½å‡½å¼
        window.useMaxPoints = function() {
            const pointsInput = document.getElementById('usePointsAmount');
            if (!pointsInput) return;

            // è¨ˆç®—é‚è¼¯ï¼šå–æŒæœ‰é»æ•¸èˆ‡ç•¶å‰è³¼ç‰©è»Šå‰©é¤˜é‡‘é¡çš„æœ€å°å€¼ï¼Œä¸¦è‡ªå‹•å‘ä¸‹å– 100 çš„å€æ•¸
            // é€™æ¨£æŒ‰ä¸‹å»å°±ä¸æœƒç™¼ç”Ÿè¼¸å…¥è¶…éæŒæœ‰é»æ•¸æˆ–è¶…éå•†å“ç¸½åƒ¹çš„æƒ…æ³
            const maxAvailable = Math.floor(checkInData.points / 100) * 100;
            
            if (maxAvailable <= 0) {
                showNotification('ç›®å‰é»æ•¸ä¸è¶³ 100 é»ï¼Œç„¡æ³•æŠ˜æŠµ', 'error');
                pointsInput.value = 0;
            } else {
                pointsInput.value = maxAvailable;
                showNotification(`å·²è‡ªå‹•å¡«å…¥æœ€å¤§å¯ç”¨é»æ•¸ï¼š${maxAvailable} é»`, 'success');
            }

            // å¡«å…¥å¾Œæ‰‹å‹•è§¸ç™¼ displayCart() æ›´æ–°ç¸½è¨ˆé‡‘é¡é¡¯ç¤º
            displayCart();
        };

window.validatePointsInput = function() {
    const pointsInput = document.getElementById('usePointsAmount');
    if (!pointsInput) return 0;
    
    let val = parseInt(pointsInput.value);

    // å¦‚æœè¼¸å…¥ç‚ºç©ºæˆ–å°æ–¼ 0ï¼Œé‡è¨­ç‚º 0
    if (isNaN(val) || val < 0) {
        // ä¸å¿…å¼·è¡Œæ”¹ input å€¼ï¼Œè®“ä½¿ç”¨è€…è‡ªå·±è¼¸å…¥ï¼Œä½†è¨ˆç®—æ™‚å›å‚³ 0
        return 0;
    }

    // é˜²å‘†ï¼šä¸Šé™æª¢æŸ¥ï¼Œä¸èƒ½è¶…éæŒæœ‰çš„ç¸½é»æ•¸
    if (val > checkInData.points) {
        showNotification(`é»æ•¸ä¸è¶³ï¼æ‚¨ç›®å‰åƒ…æœ‰ ${checkInData.points} é»`, 'error');
        val = Math.floor(checkInData.points / 100) * 100; // è‡ªå‹•ä¿®æ­£ç‚ºæœ€å¤§å¯ç”¨çš„ 100 å€æ•¸
        pointsInput.value = val;
    }
    
    // è¿”å›å€¼å¼·åˆ¶å‘ä¸‹å– 100 çš„å€æ•¸ (ä¾‹å¦‚ 150 -> 100)ï¼Œç¢ºä¿ 100 é»æŠ˜ 1 å…ƒçš„é‚è¼¯æ­£ç¢º
    return Math.floor(val / 100) * 100;
};

        // 2. æ•´åˆç‰ˆï¼šé¡¯ç¤ºè³¼ç‰©è»Š (è™•ç† å„ªæƒ åˆ¸ + é»æ•¸æŠ˜æŠµ + å•†å“æ¸…å–®)
        window.displayCart = function() {
            const container = document.getElementById('cartItems');
            const selector = document.getElementById('couponSelector');
            const pointsInput = document.getElementById('usePointsAmount');
            const subtotal = cart.reduce((a, b) => a + (b.price * b.quantity), 0);
            
            // æ›´æ–° UI é»æ•¸æ–‡å­—
            document.querySelectorAll('.points-val').forEach(el => el.textContent = checkInData.points);

            // æ›´æ–°å„ªæƒ åˆ¸é¸å–®
            const savedCouponIndex = selector.value;
            selector.innerHTML = '<option value="-1">ä¸ä½¿ç”¨å„ªæƒ åˆ¸</option>' + 
                checkInData.coupons.map((c, i) => `<option value="${i}" ${savedCouponIndex == i ? 'selected' : ''}>${c.text}</option>`).join('');

            let tempPrice = subtotal;
            let appliedCoupon = null;
            const selectedIndex = parseInt(selector.value);

            // è¨ˆç®—å„ªæƒ åˆ¸
            if (selectedIndex !== -1 && checkInData.coupons[selectedIndex]) {
                appliedCoupon = checkInData.coupons[selectedIndex];
                if (appliedCoupon.type === 'percent') tempPrice = Math.floor(subtotal * appliedCoupon.value);
                else if (appliedCoupon.type === 'cash') tempPrice = Math.max(0, subtotal - appliedCoupon.value);
            }

            // åŸ·è¡Œé»æ•¸é˜²å‘†èˆ‡è¨ˆç®—
            let usePoints = validatePointsInput();
            let pointsDiscount = Math.floor(usePoints / 100);

            // äºŒæ¬¡é˜²å‘†ï¼šæŠ˜æŠµä¸èƒ½å¤§æ–¼å‰©é¤˜é‡‘é¡
            if (pointsDiscount > tempPrice) {
                pointsDiscount = tempPrice;
                usePoints = pointsDiscount * 100;
                pointsInput.value = usePoints;
            }
            
            const finalPrice = Math.max(0, tempPrice - pointsDiscount);

            // æ¸²æŸ“å•†å“ (åŒ…å«åˆªé™¤æŒ‰éˆ•)
            container.innerHTML = cart.length ? cart.map((item, index) => `
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; padding-bottom:5px; border-bottom:1px solid #eee">
                    <div style="flex:1"><div style="font-weight:bold">${item.name}</div><div style="font-size:12px; color:#666">$${item.price} x ${item.quantity}</div></div>
                    <div style="font-weight:bold; margin-right:10px">$${item.price * item.quantity}</div>
                    <button onclick="removeCartItem(${index})" style="background:#ff4757; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer; font-size:11px">åˆªé™¤</button>
                </div>`).join('') : 'è³¼ç‰©è»Šæ˜¯ç©ºçš„';

            // é¡¯ç¤ºæŠ˜æ‰£è³‡è¨Š
            const discInfo = document.getElementById('discountInfo');
            let infoText = "";
            if (appliedCoupon && cart.length > 0) infoText += `ğŸŸï¸ å„ªæƒ åˆ¸ï¼š${appliedCoupon.text}<br>`;
            if (pointsDiscount > 0 && cart.length > 0) infoText += `ğŸ’° é»æ•¸æŠ˜æŠµï¼š-$${pointsDiscount} (ä½¿ç”¨ ${usePoints} é»)`;
            discInfo.innerHTML = infoText;

            // æ›´æ–°ç¸½é‡‘é¡
            if ((appliedCoupon || pointsDiscount > 0) && cart.length > 0) {
                document.getElementById('cartTotal').innerHTML = `<del style="color:#999; font-size:14px; margin-right:10px">$${subtotal}</del> $${finalPrice}`;
            } else {
                document.getElementById('cartTotal').textContent = `$${subtotal}`;
            }
        };

        // 3. æ•´åˆç‰ˆï¼šçµå¸³æµç¨‹ (ç¢ºä¿æ‰£é™¤é¸æ“‡çš„åˆ¸èˆ‡æ­£ç¢ºçš„é»æ•¸)
        window.checkoutProcess = function() {
            if (cart.length === 0) return showNotification('è³¼ç‰©è»Šæ˜¯ç©ºçš„', 'error');
            
            let usePoints = validatePointsInput();
            const pointsDiscount = Math.floor(usePoints / 100);
            const actualUsedPoints = pointsDiscount * 100;

            const subtotal = cart.reduce((a, b) => a + (b.price * b.quantity), 0);
            const selector = document.getElementById('couponSelector');
            const selectedIndex = parseInt(selector.value);
            
            let currentPrice = subtotal;

            if (selectedIndex !== -1 && checkInData.coupons[selectedIndex]) {
                const coupon = checkInData.coupons[selectedIndex];
                if (coupon.type === 'percent') currentPrice = Math.floor(subtotal * coupon.value);
                else if (coupon.type === 'cash') currentPrice = Math.max(0, subtotal - coupon.value);
                checkInData.coupons.splice(selectedIndex, 1); // æ­£å¼ç§»é™¤é¸ä¸­çš„å„ªæƒ åˆ¸
            }

            const finalPrice = Math.max(0, currentPrice - pointsDiscount);

            // æ­£å¼æ‰£é»èˆ‡å„²å­˜
            checkInData.points -= actualUsedPoints;
            saveCheckInData();

            // æœƒå“¡æ¶ˆè²»ç´¯ç©
            currentUser.totalSpent = (currentUser.totalSpent || 0) + finalPrice;
            localStorage.setItem(`user_${currentUser.email}`, JSON.stringify(currentUser));
            updateMemberRank();

            // é‡ç½®ä»‹é¢
            cart = [];
            saveCart();
            document.getElementById('usePointsAmount').value = "";
            selector.value = "-1";
            closeCart();
            showNotification(`æ”¯ä»˜æˆåŠŸï¼å¯¦ä»˜ $${finalPrice}ï¼Œæ‰£é™¤ ${actualUsedPoints} é»`, 'success');
        };
    // æ–°å¢ï¼šè™•ç†ç§»é™¤å•†å“çš„å‡½å¼
    window.removeCartItem = function(index) {
        // å¾å…¨åŸŸè®Šæ•¸ cart é™£åˆ—ä¸­ç§»é™¤è©²ç´¢å¼•çš„å•†å“
        cart.splice(index, 1);
        
        // å‘¼å«æ‚¨åŸæœ¬å®šç¾©çš„ saveCart() ä¾†å„²å­˜ LocalStorage ä¸¦æ›´æ–°å³ä¸Šè§’æ•¸å­—
        saveCart(); 
        
        // é‡æ–°åŸ·è¡Œ displayCart() æ›´æ–°å½ˆå‡ºè¦–çª—å…§çš„å…§å®¹
        displayCart(); 
        
        // å‘¼å«æ‚¨åŸæœ¬çš„ showNotification()
        showNotification('å•†å“å·²å¾è³¼ç‰©è»Šç§»é™¤', 'success');
    };
    
</script>
</body>
</html>